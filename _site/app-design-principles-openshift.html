<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content=" ">
<title>Application Design Principles for OpenShift | Enterprise Architecture</title>
<link rel="stylesheet" href="css/syntax.css">

<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="css/modern-business.css">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link rel="stylesheet" href="css/customstyles.css">
<link rel="stylesheet" href="css/boxshadowproperties.css">
<!-- most color styles are extracted out to here -->
<link rel="stylesheet" href="css/theme-blue.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>


<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Anchor.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.0/anchor.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<link rel="shortcut icon" href="images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="ocio-enterprise-architecture" href="http://localhost:4000/feed.xml">



    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-static-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="index.html">&nbsp;<span class="projectTitle"> Enterprise Architecture</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- toggle sidebar button -->
                <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li>
                <!-- entries without drop-downs appear here -->




                
                
                
                <li><a href="https://github.com/bcgov/ocio-enterprise-architecture/" target="_blank" rel="noopener">GitHub</a></li>
                
                
                
                <li><a href="news">News</a></li>
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
			<li>



  <a class="email" title="Submit feedback" href="#" onclick="javascript:window.location='mailto:?subject= feedback&body=I have some feedback about the Application Design Principles for OpenShift page: ' + window.location.href;"><i class="fa fa-envelope-o"></i> Feedback</a>

</li>



		
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="Application Design Principles for OpenShift">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>



<!-- Page Content -->
<div class="container">
  <div id="main">
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                

<ul id="mysidebar" class="nav">
  <li class="sidebarTitle"> </li>
  
      <!-- if you aren't using the accordion, uncomment this block:
         <p class="external">
             <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
         </p>
         -->
</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>



            </div>
            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
            <div class="post-header">
   <h1 class="post-title-main">Application Design Principles for OpenShift</h1>
</div>



<div class="post-content">

   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})

});
</script>

<div id="toc"></div>



    


  <!--    -->

   <h2 id="design-principles">Design Principles</h2>

<h3 id="1-build-once-deploy-multiple-times">1: Build Once, Deploy Multiple Times</h3>

<p>Build your application image in the Tools Namespace and deploy the image in the Dev, Test and Prod namespaces. In order to do this using a CI/CD workflow, it is important to build and deploy using build and deployment templates. Creating deployments using the console would deter redeploying if the pod comes down for maintenance. After the openshift build process, the image is stored in the imagestreams object with the Tools Namespace. There are two known methods to deploy images to the Dev,Test, Prod Namespace after the build process:</p>
<ol>
  <li>Tag the image in the dev, test, prod namespaces within your CI/CD workflow once the build process is complete using the command:</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oc tag &lt;license-plate&gt;-tools/image-name  &lt;license-plate&gt;-&lt;dev/test/prod&gt;/image-name
</code></pre></div></div>

<p>This commands needs to be run each time the image is built.</p>

<p>To perform this process, it is essential to provide permissions to the service account, image-puller in dev/test/prod namespace to be access the imagestreams in tools namespaces. This can be done using the command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    oc policy add-role-to-user \
    system:image-puller system:serviceaccount:&lt;license-plate&gt;-tools:default \
    --namespace=&lt;license-plate&gt;-&lt;dev/test/prod&gt;
</code></pre></div></div>

<p>This command only needs to be run once.</p>

<ol>
  <li>Deploy the Image from the tools namespace, but make sure that when you use this method, that you do not delete the image so that if and when the pod requires to come back up, it does not throw an error due to unavailability of the image.</li>
</ol>

<p>To perform this process, it is essential to provide permissions to the service account, image-puller in dev/test/prod namespace to be access the imagestreams in tools namespaces. This can be done using the command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    oc policy add-role-to-user \
    system:image-puller system:serviceaccount:&lt;license-plate&gt;-tools:default \
    --namespace=&lt;license-plate&gt;-&lt;dev/test/prod&gt;
</code></pre></div></div>

<p>This command only needs to be run once.</p>

<p>To understand more about images and image tags, Click <a href="https://mvp.developer.gov.bc.ca/docs/default/component/platform-developer-docs/docs/build-deploy-and-maintain-apps/imagestreams/">here</a>.</p>

<h3 id="2-zero-trust-network">2. Zero Trust Network</h3>

<p>By design all pods in OpenShift are accessible to other pods within the cluster as well as to external endpoints through a route. To prevent data breaches, the concept of zero trust network works on the principles of never trust, always verify. From OpenShift version 4.10, CLAB, KLAB, SILVER, GOLD, GOLD-DR clusters are now supporting limited Egress network policies. KLAB2 and Emerald clusters use a different SDN technology (VMWare NSX-T) which also support and require Egress Network Policies. The platform-services-controlled-default network policy controlled by the platform administrators is applied to all namespaces on OpenShift and will be applied even if you delete it. This policy enforces zero trust network and denies all access by default. As a responsible developer, you need to ensure you do not open all access to your pods and build network policies that only allow necessary access.</p>

<p>To learn how to apply network policies, click <a href="https://mvp.developer.gov.bc.ca/docs/default/component/platform-developer-docs/docs/platform-architecture-reference/openshift-network-policies/">here</a>.</p>

<h3 id="3-always-run-at-least-2-pods">3. Always run at least 2 pods</h3>

<p>Openshift pods are meant to be transient or ephemeral. To ensure high availability, it is therefore important to atleast run 2 pods and design your application to be able to operate on more than one instance. Running multiple pods can be done by setting the following field within the deployment config in your deployment template.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> spec:
   replicas: &lt;number of replicas (more than 2)&gt;
</code></pre></div></div>

<h3 id="4-spread-your-pods-across-nodes">4. Spread your pods across nodes</h3>

<p>It is not desirable to have all the pods or replicas on the same node within the OpenShift cluster, which leaves a risk of downtime of your application when the node is taken down for maintenance. OpenShift already does a good job of spreading out the pods across nodes based on resource availability and the general recommendation is not to interfer with OpenShift’s scheduling policy. However, if you do require to enforce the behavior, a pod anti-affinity rule can be set up to prevent OpenShift from scheduling pods of a particular service on the same node. To read more about setting an anti-affinity rule in your deployment configuration, click <a href="https://mvp.developer.gov.bc.ca/docs/default/component/platform-developer-docs/docs/automation-and-resiliency/app-resiliency-guidelines/#examples">here</a></p>

<h3 id="5-define-a-pod-disruption-budget">5. Define a pod disruption budget</h3>

<p>Even with the anti-affinity rule in place and the OpenShift’s pod scheduling policy, there is a chance that multiple pods could land on the same node or there might be an instance when the platform administrator decides to take down multiple nodes down for maintenance at the same time. To prevent your pods from going down all at once, you can set up a pod disruption budget. A pod disruption budget defines the minimum number of pods that must be available simultaneously. To read more about setting pod disruption budgets, click <a href="https://mvp.developer.gov.bc.ca/docs/default/component/platform-developer-docs/docs/build-deploy-and-maintain-apps/maintain-an-application/#pdbs-pod-disruption-budgets">here</a></p>

<h3 id="6--do-not-use-localhost-path-storage">6.  Do not use local/host path storage</h3>

<p>Using local or hostPath storage will tie pods to the nodes where the storage exists, making it impossible for the pods to migrate during a maintainence activity.</p>

<h3 id="7-design-your-application-so-that-it-can-tolerate-pods-going-down">7. Design your application so that it can tolerate pods going down</h3>

<p>Your application pods will be killed during a node maintenance activity. OpenShift initially sends a SIGTERM to the pod which allows time for the app to shutdown. If the app doesn’t shutdown within a given timeframe, OpenShift would then send a SIGKILL to the application process which would kill the process instantly without leaving time for existing client sessions to end. The application therefore needs to be designed so that it can quickly clean up when it recieves a SIGTERM and the server-side application needs to be stateless so that request for inflight client sessions can resume without hassles on a different pod. If the server-side application needs to maintain state, it has to be persisted using a cache or a database so that it can be retrieved by other pods.</p>

<h3 id="8-use-resources-graciously">8. Use resources graciously</h3>

<p>The OpenShift platform is currently free for ministry teams to deploy their applications. However, this is not the case in Public Cloud and there is also a possibility that the OpenShift platform will be charged in the future. The application will be charged based on CPU, Memory and Storage resource usage and therefore it is essential to consistently monitor your application and ensure the CPU and memory requests and limits are adjusted according to usage. It is also essential to ensure that you are caching and managing storage wisely. It also becomes important to monitor the network traffic to ensure that you are not spending money on network resources unwisely. To read more about how to manage CPU and memory resources, click <a href="https://mvp.developer.gov.bc.ca/docs/default/component/platform-developer-docs/docs/automation-and-resiliency/application-resource-tuning/">here</a>.</p>



    <div class="tags">
        
    </div>


</div>



<footer>
            <div class="row">
                <div class="col-lg-12 footer">
<!--                &copy;2023 Government of British Columbia. All rights reserved. <br />
 Site last generated: Nov 8, 2023 <br /> -->
<p><img src="images/BCID_H_rgb_pos.png" alt="Company logo" style="object-fit:contain;
    width:200px;
    height:300px;"/></p>
                </div>
            </div>
</footer>

<!--  -->



        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
</div>
<!-- /#main -->
    </div>

<!-- </body>

</html> -->

<!--  -->
